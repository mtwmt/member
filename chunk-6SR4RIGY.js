import{a as i,b as M,c as L,d as v,e as A,ea as h,fa as P,g as D,ga as k,h as O,k as I,l as x,m as f,p as T,ra as W,s as d,v as R,w as j,y as p,z as U}from"./chunk-PNWZI6QW.js";var q=Symbol("DEEP_SIGNAL");function F(t){return new Proxy(t,{has(e,n){return!!this.get(e,n,void 0)},get(e,n){let o=h(e);return!V(o)||!(n in o)?(p(e[n])&&e[n][q]&&delete e[n],e[n]):(p(e[n])||(Object.defineProperty(e,n,{value:P(()=>e()[n]),configurable:!0}),e[n][q]=!0),F(e[n]))}})}var H=[WeakSet,WeakMap,Promise,Date,Error,RegExp,ArrayBuffer,DataView,Function];function V(t){if(t===null||typeof t!="object"||J(t))return!1;let e=Object.getPrototypeOf(t);if(e===Object.prototype)return!0;for(;e&&e!==Object.prototype;){if(H.includes(e.constructor))return!1;e=Object.getPrototypeOf(e)}return e===Object.prototype}function J(t){return typeof t?.[Symbol.iterator]=="function"}var Q=new WeakMap,l=Symbol("STATE_SOURCE");function u(t,...e){let n=h(()=>_(t)),o=e.reduce((r,s)=>i(i({},r),typeof s=="function"?s(r):s),n),c=t[l],a=Reflect.ownKeys(t[l]);for(let r of Reflect.ownKeys(o))if(a.includes(r)){let s=r;n[s]!==o[s]&&c[s].set(o[s])}Y(t)}function _(t){let e=t[l];return Reflect.ownKeys(t[l]).reduce((n,o)=>{let c=e[o]();return M(i({},n),{[o]:c})},{})}function X(t){return Q.get(t[l])||[]}function Y(t){let e=X(t);for(let n of e){let o=h(()=>_(t));n(o)}}function z(...t){let e=[...t],n=typeof e[0]=="function"?{}:e.shift(),o=e;return(()=>{class a{constructor(){let s=o.reduce((w,B)=>B(w),Z()),{stateSignals:y,props:m,methods:S,hooks:g}=s,b=i(i(i({},y),m),S);this[l]=s[l];for(let w of Reflect.ownKeys(b))this[w]=b[w];let{onInit:C,onDestroy:E}=g;C&&C(),E&&d(j).onDestroy(E)}static \u0275fac=function(y){return new(y||a)};static \u0275prov=T({token:a,factory:a.\u0275fac,providedIn:n.providedIn||null})}return a})()}function Z(){return{[l]:{},stateSignals:{},props:{},methods:{},hooks:{}}}function G(t){return e=>{let n=t(i(i(i({[l]:e[l]},e.stateSignals),e.props),e.methods));return M(i({},e),{methods:i(i({},e.methods),n)})}}function N(t){return e=>{let n=typeof t=="function"?t():t,o=Reflect.ownKeys(n),c=e[l],a={};for(let r of o)c[r]=U(n[r]),a[r]=F(c[r]);return M(i({},e),{stateSignals:i(i({},e.stateSignals),a)})}}function K(t,e){let n=e?.injector??d(R),o=new A,c=t(o).subscribe();n.get(j).onDestroy(()=>c.unsubscribe());let a=(r,s)=>{if(ee(r))return o.next(r),{destroy:L};let y=te(),m=s?.injector??y??n;if(p(r)){let g=k(()=>{let b=r();h(()=>o.next(b))},{injector:m});return c.add({unsubscribe:()=>g.destroy()}),g}let S=r.subscribe(g=>o.next(g));return c.add(S),m!==n&&m.get(j).onDestroy(()=>S.unsubscribe()),{destroy:()=>S.unsubscribe()}};return a.destroy=c.unsubscribe.bind(c),a}function ee(t){return!p(t)&&!O(t)}function te(){try{return d(R)}catch{return}}var $={user:null,isLoading:!1,error:null},je=z({providedIn:"root"},N($),G(t=>{let e=d(W);return{login:K(v(f(()=>u(t,{isLoading:!0,error:null})),x(n=>e.login(n).pipe(f(o=>{u(t,{user:o.user,isLoading:!1,error:null})}),I(o=>(u(t,{user:null,isLoading:!1,error:o.error?.detail||"\u767B\u5165\u5931\u6557"}),D(null))))))),register:K(v(f(()=>u(t,{isLoading:!0,error:null})),x(n=>e.register(n).pipe(f(o=>{u(t,{user:o.user,isLoading:!1,error:null})}),I(o=>(u(t,{user:null,isLoading:!1,error:o.error?.detail||"\u8A3B\u518A\u5931\u6557"}),D(null))))))),loadCurrentUser:K(v(f(()=>u(t,{isLoading:!0,error:null})),x(()=>e.getCurrentUser().pipe(f(n=>{u(t,{user:n,isLoading:!1,error:null})}),I(n=>(u(t,{user:null,isLoading:!1,error:n.error?.detail||"\u53D6\u5F97\u4F7F\u7528\u8005\u8CC7\u8A0A\u5931\u6557"}),D(null))))))),logout:()=>{e.logout(),u(t,$)},clearError:()=>{u(t,{error:null})}}}));export{je as a};
